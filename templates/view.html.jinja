{% extends "template.html" %}
{% from "functions.jinja" import render_comment %}
{% block title %}Post {{post.id}} {% endblock %}

{% block body %}
    <section> <!-- Display post -->
        <section>
            <h3>{{ post.title }}</h3>
            {% for image_index in range(post.image_count) %}
                {# each image gets it's own id based on their parent post and their id in that specific post#} 
                <section id="image{{image_index}}_{{ post.id }}" class="img_posts img_view" style="background-image:url({{ url_for('get_image', filename = image_index ~ 'postimage_' ~ post.id ~ '.jpg') }}); background-size: auto 100%; {# makes an image scale correctly #}" {% if loop.first %} visible {% else %} hidden {% endif %}>
                {% if not loop.first %} {# _image_index + 1 and -1 are index to which image has to become visible when this button is pressed that's why images also have ids with their index #}
                    <button onclick="switchImage({{ image_index }}, {{ image_index - 1 }}, {{ post.id }})" class="btn btn-success" style="display: inline; margin-right:auto;"><-</button>
                {% endif %} 
                {% if not loop.last %}
                    <button onclick="switchImage({{ image_index }}, {{ image_index + 1 }}, {{ post.id }})" class="btn btn-success" style="display: inline; margin-left:auto;">-></button>
                {% endif %}
                </section>
            {% endfor %}
            {% for line in load(post.post_content) %} {# List has to be loaded because it was stored in JSON -- used to display text exactly as it was given #}
                <p class="card-text">{{ line }}</p>
            {% endfor %}
        </section>
        <section>
            <p class="card-footer">Author: {{ post.username }}, Posted on: {{ moment(get_date(post.time)).format('h:mm:ss a') }}</p>
        </section>
    </section>
    <form method="post" action="/view/post/{{ post.id }}"> <!-- Form that allows to add comment if user is logged in -->
        <textarea name="comment" style="display: inline-block;" placeholder="Add a comment"></textarea>
        <button type="submit" style="display: inline-block;">Add</button>
    </form>
    <hr>
    <section> <!-- Display comments -->
        {% for comment in comments if comment.parent_id is none %}
            {{ render_comment(comment, comment_reactions, post, current_user, get_date, moment) }} <!-- Render comment using a macro -->
        {% endfor %}
    </section>
{% endblock %}